<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Burak Multiomics - Population Health</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg-deep: #020617;
            --bg-card: #0f172a;
            --bg-elevated: #1e293b;
            --border-subtle: rgba(71,85,105,0.2);  
            --border-hover: rgba(96,165,250,0.3);
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --accent-blue: #60a5fa;
            --accent-teal: #2dd4bf;
            --accent-violet: #a78bfa;
            --accent-rose: #f472b6;
            --accent-amber: #fbbf24;
            --accent-emerald: #34d399;
            --accent-red: #fb7185;
            --accent-cyan: #22d3ee;
            --accent-purple: #a855f7;
            --accent-pink: #ec4899;
        }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; 
            background: linear-gradient(145deg, #020617 0%, #0f172a 50%, #020617 100%);
            color: var(--text-primary); 
            min-height: 100vh;
            line-height: 1.6;
            font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11';
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* Animated Background - Same as Home */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(34,211,238,0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(168,85,247,0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(236,72,153,0.05) 0%, transparent 60%);
            pointer-events: none;
            z-index: 0;
        }
        
        /* Navigation - Same as Home Page */
        .nav {
            background: rgba(2,6,23,0.9);
            backdrop-filter: blur(24px);
            border-bottom: 1px solid rgba(34,211,238,0.1);
            padding: 16px 48px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .nav-brand { display: flex; align-items: center; gap: 14px; }
        
        /* Same Logo as Home Page */
        .nav-logo-container {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6, #ec4899);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 24px rgba(139,92,246,0.35);
            position: relative;
            animation: logoGlow 4s ease-in-out infinite;
        }
        
        @keyframes logoGlow {
            0%, 100% { box-shadow: 0 4px 24px rgba(139,92,246,0.35); }
            50% { box-shadow: 0 4px 32px rgba(139,92,246,0.5); }
        }
        
        .nav-logo-container::before {
            content: '';
            position: absolute;
            inset: 2px;
            background: rgba(10,15,26,0.9);
            border-radius: 12px;
        }
        
        .nav-logo { font-size: 24px; position: relative; z-index: 1; }
        
        .nav-title-group { display: flex; flex-direction: column; }
        .nav-title { 
            font-size: 22px; 
            font-weight: 800; 
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-violet));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .nav-subtitle { 
            font-size: 10px; 
            font-weight: 600; 
            color: var(--text-muted); 
            text-transform: uppercase; 
            letter-spacing: 2px; 
            margin-top: 2px; 
        }
        
        .nav-right { display: flex; align-items: center; gap: 12px; }
        
        .status-pill {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(52,211,153,0.06);
            border: 1px solid rgba(52,211,153,0.12);
            border-radius: 24px;
        }
        
        .status-dot {
            width: 7px;
            height: 7px;
            background: var(--accent-emerald);
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(52,211,153,0.5);
            animation: pulse 2.5s ease-in-out infinite;
        }
        
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
        
        .status-text { font-size: 11px; color: var(--accent-emerald); font-weight: 600; letter-spacing: 0.5px; }
        
        .nav-btn {
            padding: 10px 20px;
            background: rgba(30,41,59,0.5);
            border: 1px solid rgba(71,85,105,0.2);
            border-radius: 10px;
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            letter-spacing: 0.3px;
        }
        
        .nav-btn:hover {
            background: rgba(59,130,246,0.08);
            border-color: rgba(96,165,250,0.25);
            color: var(--text-primary);
            transform: translateY(-1px);
        }
        
        /* Main Container - Centered & Reduced */
        .main { max-width: 1140px; margin: 0 auto; padding: 40px 32px; position: relative; z-index: 1; }
        
        /* Page Header */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 36px;
            padding-bottom: 28px;
            border-bottom: 1px solid var(--border-subtle);
        }
        
        .page-title-group {}
        .page-label { 
            font-size: 11px; 
            font-weight: 700; 
            color: var(--accent-blue); 
            text-transform: uppercase; 
            letter-spacing: 3px; 
            margin-bottom: 10px; 
        }
        .page-title { 
            font-size: 30px; 
            font-weight: 800; 
            color: var(--text-primary); 
            letter-spacing: -1px;
            line-height: 1.1;
        }
        
        .page-meta { display: flex; gap: 28px; }
        .meta-item { text-align: right; }
        .meta-value { 
            font-size: 24px; 
            font-weight: 800; 
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-violet));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .meta-label { 
            font-size: 10px; 
            color: var(--text-muted); 
            text-transform: uppercase; 
            letter-spacing: 1px; 
            font-weight: 500;
            margin-top: 4px;
        }
        
        /* Section */
        .section { margin-bottom: 36px; }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 12px;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-icon { font-size: 15px; }
        
        .section-badge {
            padding: 5px 14px;
            background: rgba(96,165,250,0.06);
            border: 1px solid rgba(96,165,250,0.1);
            border-radius: 20px;
            font-size: 10px;
            font-weight: 600;
            color: var(--accent-blue);
            letter-spacing: 0.5px;
        }
        
        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 18px;
        }
        
        .kpi-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.35s ease;
            position: relative;
            overflow: hidden;
        }
        
        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            opacity: 0.8;
        }
        
        .kpi-card.total::before { background: linear-gradient(90deg, var(--accent-cyan), var(--accent-blue)); }
        .kpi-card.risk::before { background: linear-gradient(90deg, var(--accent-red), var(--accent-rose)); }
        .kpi-card.intervention::before { background: linear-gradient(90deg, var(--accent-amber), #fcd34d); }
        .kpi-card.partner::before { background: linear-gradient(90deg, var(--accent-violet), var(--accent-rose)); }
        
        .kpi-card.clickable { cursor: pointer; }
        .kpi-card.clickable:hover {
            border-color: var(--border-hover);
            transform: translateY(-4px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
        }
        
        .kpi-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .kpi-label { 
            font-size: 11px; 
            color: var(--text-muted); 
            text-transform: uppercase; 
            letter-spacing: 1.5px; 
            font-weight: 600; 
        }
        
        .kpi-trend {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 0.3px;
        }
        
        .trend-up { background: rgba(251,113,133,0.08); color: var(--accent-red); }
        .trend-down { background: rgba(52,211,153,0.08); color: var(--accent-emerald); }
        .trend-stable { background: rgba(251,191,36,0.08); color: var(--accent-amber); }
        
        .kpi-value { 
            font-size: 44px; 
            font-weight: 800; 
            line-height: 1; 
            margin-bottom: 8px; 
            letter-spacing: -2px;
            font-variant-numeric: tabular-nums;
        }
        
        .kpi-card.total .kpi-value { color: var(--accent-cyan); }
        .kpi-card.risk .kpi-value { color: var(--accent-red); }
        .kpi-card.intervention .kpi-value { color: var(--accent-amber); }
        
        .kpi-sub { 
            font-size: 13px; 
            color: var(--text-muted); 
            font-weight: 500;
            letter-spacing: 0.2px;
        }
        
        .kpi-hint { 
            font-size: 11px; 
            color: var(--accent-blue); 
            margin-top: 20px; 
            opacity: 0; 
            transition: opacity 0.25s;
            font-weight: 600;
            letter-spacing: 0.3px;
        }
        .kpi-card.clickable:hover .kpi-hint { opacity: 1; }
        
        /* Partner Card */
        .partner-header { display: flex; align-items: center; gap: 14px; margin-bottom: 24px; }
        .partner-logo {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--accent-violet), var(--accent-rose));
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
            font-weight: 800;
            color: white;
            letter-spacing: -0.5px;
            box-shadow: 0 4px 16px rgba(167,139,250,0.25);
        }
        .partner-name { font-size: 16px; font-weight: 700; color: var(--text-primary); letter-spacing: -0.3px; }
        .partner-type { font-size: 11px; color: var(--text-muted); font-weight: 500; margin-top: 2px; }
        
        .batch-select {
            width: 100%;
            padding: 14px 18px;
            background: var(--bg-deep);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%2394a3b8' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            margin-bottom: 20px;
            letter-spacing: 0.2px;
            transition: all 0.25s;
        }
        
        .batch-select:hover { border-color: var(--border-hover); }
        .batch-select:focus { outline: none; border-color: var(--accent-blue); }
        .batch-select option { background: var(--bg-card); padding: 12px; }
        
        .gut-row { display: flex; gap: 14px; }
        .gut-item { 
            flex: 1; 
            text-align: center; 
            padding: 18px 14px; 
            background: var(--bg-deep); 
            border-radius: 14px;
            border: 1px solid var(--border-subtle);
        }
        .gut-value { 
            font-size: 24px; 
            font-weight: 800; 
            color: var(--accent-teal); 
            letter-spacing: -1px;
            font-variant-numeric: tabular-nums;
        }
        .gut-label { 
            font-size: 9px; 
            color: var(--text-muted); 
            text-transform: uppercase; 
            margin-top: 6px; 
            letter-spacing: 1px;
            font-weight: 600;
        }
        
        /* Insights Row */
        .insights-row {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 14px;
        }
        
        .insight-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 14px;
            padding: 22px 18px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .insight-card:hover {
            border-color: var(--border-hover);
            transform: translateY(-3px);
        }
        
        .insight-icon { font-size: 22px; margin-bottom: 12px; }
        .insight-value { 
            font-size: 22px; 
            font-weight: 800; 
            margin-bottom: 6px; 
            letter-spacing: -0.5px;
            font-variant-numeric: tabular-nums;
        }
        .insight-label { 
            font-size: 10px; 
            color: var(--text-muted); 
            text-transform: uppercase; 
            letter-spacing: 1px;
            font-weight: 600;
        }
        
        .insight-card:nth-child(1) .insight-value { color: var(--accent-amber); }
        .insight-card:nth-child(2) .insight-value { color: var(--accent-blue); }
        .insight-card:nth-child(3) .insight-value { color: var(--accent-teal); }
        .insight-card:nth-child(4) .insight-value { color: var(--accent-violet); }
        .insight-card:nth-child(5) .insight-value { color: var(--accent-emerald); }
        
        /* Cohort Grid */
        .cohort-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 18px;
        }
        
        .cohort-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.35s ease;
            position: relative;
            overflow: hidden;
        }
        
        .cohort-card:hover {
            border-color: var(--border-hover);
            transform: translateY(-4px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.12);
        }
        
        .cohort-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
        .cohort-icon { font-size: 36px; }
        .cohort-gut { 
            font-size: 10px; 
            font-weight: 700; 
            padding: 6px 12px; 
            border-radius: 20px; 
            background: rgba(45,212,191,0.08); 
            color: var(--accent-teal);
            letter-spacing: 0.3px;
        }
        
        .cohort-name { 
            font-size: 16px; 
            font-weight: 700; 
            color: var(--text-primary); 
            margin-bottom: 8px;
            letter-spacing: -0.3px;
        }
        
        .cohort-stats { display: flex; align-items: baseline; gap: 10px; margin-bottom: 22px; }
        .cohort-count { 
            font-size: 36px; 
            font-weight: 800; 
            line-height: 1; 
            color: var(--accent-blue);
            letter-spacing: -1.5px;
            font-variant-numeric: tabular-nums;
        }
        .cohort-pct { 
            font-size: 15px; 
            color: var(--text-muted); 
            font-weight: 600;
            letter-spacing: -0.3px;
        }
        
        .match-row { margin-bottom: 28px; }
        .match-header { 
            display: flex; 
            justify-content: space-between; 
            font-size: 11px; 
            color: var(--text-muted); 
            margin-bottom: 12px;
            font-weight: 600;
            letter-spacing: 0.3px;
        }
        .match-bar { height: 6px; background: var(--bg-deep); border-radius: 3px; overflow: hidden; }
        .match-fill { height: 100%; border-radius: 3px; transition: width 0.6s ease; }
        .match-high { background: linear-gradient(90deg, var(--accent-red), var(--accent-rose)); }
        .match-medium { background: linear-gradient(90deg, var(--accent-amber), #fcd34d); }
        .match-low { background: linear-gradient(90deg, var(--accent-emerald), var(--accent-teal)); }
        
        .risk-row { display: flex; gap: 12px; }
        .risk-item { 
            flex: 1; 
            text-align: center; 
            padding: 18px 12px; 
            background: var(--bg-deep); 
            border-radius: 14px;
            border: 1px solid var(--border-subtle);
            transition: all 0.25s;
        }
        .risk-item:hover { border-color: var(--border-hover); }
        .risk-value { 
            font-size: 22px; 
            font-weight: 800; 
            line-height: 1; 
            margin-bottom: 8px;
            letter-spacing: -1px;
            font-variant-numeric: tabular-nums;
        }
        .risk-label { 
            font-size: 9px; 
            color: var(--text-muted); 
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }
        .risk-item.critical .risk-value { color: var(--accent-red); }
        .risk-item.warning .risk-value { color: var(--accent-amber); }
        .risk-item.stable .risk-value { color: var(--accent-emerald); }
        
        /* Engine */
        .engine-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 12px;
        }
        
        .engine-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 18px 14px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .engine-card:hover { border-color: var(--border-hover); transform: translateY(-2px); }
        
        .engine-value { 
            font-size: 24px; 
            font-weight: 800; 
            margin-bottom: 6px;
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-violet));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-variant-numeric: tabular-nums;
        }
        .engine-label { 
            font-size: 8px; 
            color: var(--text-muted); 
            text-transform: uppercase; 
            letter-spacing: 1px; 
            margin-bottom: 12px;
            font-weight: 600;
        }
        .engine-bar { height: 3px; background: var(--bg-deep); border-radius: 2px; overflow: hidden; }
        .engine-fill { height: 100%; background: linear-gradient(90deg, var(--accent-blue), var(--accent-violet)); animation: engineGlow 2.5s ease-in-out infinite; }
        @keyframes engineGlow { 0%, 100% { opacity: 0.4; } 50% { opacity: 1; } }
        
        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(10,15,26,0.95);
            backdrop-filter: blur(16px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 48px;
        }
        
        .modal-overlay.active { display: flex; }
        
        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 24px;
            width: 100%;
            max-width: 1140px;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 40px 120px rgba(0,0,0,0.4);
        }
        
        .modal-header {
            padding: 32px 40px;
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title { 
            display: flex; 
            align-items: center; 
            gap: 16px; 
            font-size: 22px; 
            font-weight: 800;
            letter-spacing: -0.5px;
        }
        .modal-count { 
            font-size: 15px; 
            color: var(--text-muted); 
            font-weight: 500;
            letter-spacing: 0.2px;
        }
        
        .modal-close {
            width: 48px;
            height: 48px;
            border-radius: 14px;
            background: var(--bg-deep);
            border: 1px solid var(--border-subtle);
            color: var(--text-muted);
            font-size: 20px;
            cursor: pointer;
            transition: all 0.25s;
        }
        
        .modal-close:hover { 
            background: rgba(251,113,133,0.08); 
            color: var(--accent-red); 
            border-color: rgba(251,113,133,0.15); 
        }
        
        .modal-body { padding: 32px 40px; overflow-y: auto; flex: 1; }
        
        .patient-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; }
        
        .patient-card {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 18px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .patient-card:hover { 
            border-color: var(--border-hover); 
            transform: translateY(-3px);
            box-shadow: 0 12px 32px rgba(0,0,0,0.15);
        }
        
        .patient-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; }
        .patient-id { 
            font-size: 15px; 
            font-weight: 800; 
            color: var(--accent-cyan);
            letter-spacing: -0.3px;
        }
        .patient-gut { font-size: 16px; }
        .patient-gut.dormant { opacity: 0.15; }
        
        .patient-match {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px;
            background: var(--bg-deep);
            border-radius: 14px;
            margin-bottom: 18px;
        }
        
        .patient-pct { 
            font-size: 32px; 
            font-weight: 800; 
            line-height: 1;
            letter-spacing: -2px;
            font-variant-numeric: tabular-nums;
        }
        .patient-pct.high { color: var(--accent-red); }
        .patient-pct.medium { color: var(--accent-amber); }
        .patient-pct.low { color: var(--accent-emerald); }
        
        .patient-risk {
            padding: 7px 14px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }
        
        .patient-risk.critical { background: rgba(251,113,133,0.1); color: var(--accent-red); }
        .patient-risk.warning { background: rgba(251,191,36,0.1); color: var(--accent-amber); }
        .patient-risk.stable { background: rgba(52,211,153,0.1); color: var(--accent-emerald); }
        
        .patient-cohort { display: flex; align-items: center; gap: 12px; margin-bottom: 18px; }
        .patient-cohort-icon { font-size: 22px; }
        .patient-cohort-name { font-size: 13px; font-weight: 600; color: var(--text-secondary); letter-spacing: 0.2px; }
        
        .patient-secondary { margin-bottom: 18px; }
        .secondary-label { 
            font-size: 9px; 
            color: var(--text-muted); 
            text-transform: uppercase; 
            margin-bottom: 12px;
            letter-spacing: 1px;
            font-weight: 600;
        }
        .secondary-tags { display: flex; flex-wrap: wrap; gap: 8px; }
        .sec-tag { 
            display: flex; 
            align-items: center; 
            gap: 6px; 
            padding: 6px 12px; 
            background: var(--bg-deep); 
            border-radius: 8px; 
            font-size: 12px;
            border: 1px solid var(--border-subtle);
        }
        .sec-tag-pct { font-weight: 700; color: var(--text-primary); letter-spacing: -0.3px; }
        
        .patient-footer { padding-top: 18px; border-top: 1px solid var(--border-subtle); text-align: right; }
        .clinical-link { 
            font-size: 12px; 
            color: var(--accent-blue); 
            font-weight: 700;
            letter-spacing: 0.3px;
        }
        
        /* Footer */
        .footer { 
            text-align: center; 
            padding: 48px 24px; 
            border-top: 1px solid var(--border-subtle); 
            margin-top: 24px; 
        }
        .footer-text { font-size: 13px; color: var(--text-muted); font-weight: 500; letter-spacing: 0.3px; }
        .footer-name { 
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-violet));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700; 
        }
        
        /* Analytics Section */
        .analytics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }
        
        .analytics-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 18px;
            padding: 28px;
            position: relative;
            overflow: hidden;
        }
        
        .analytics-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
        }
        
        .analytics-card.distribution::before {
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-violet));
        }
        
        .analytics-card.alerts::before {
            background: linear-gradient(90deg, var(--accent-amber), var(--accent-red));
        }
        
        .analytics-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .analytics-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .analytics-title-icon { font-size: 18px; }
        
        /* Donut Chart */
        .donut-container {
            display: flex;
            align-items: center;
            gap: 32px;
        }
        
        .donut-chart {
            position: relative;
            width: 180px;
            height: 180px;
        }
        
        .donut-chart svg {
            transform: rotate(-90deg);
        }
        
        .donut-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        
        .donut-center-value {
            font-size: 32px;
            font-weight: 900;
            color: var(--text-primary);
            letter-spacing: -1px;
            line-height: 1;
        }
        
        .donut-center-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 4px;
        }
        
        .donut-legend {
            display: flex;
            flex-direction: column;
            gap: 12px;
            flex: 1;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 14px;
            background: var(--bg-deep);
            border-radius: 10px;
            transition: all 0.25s;
            cursor: pointer;
        }
        
        .legend-item:hover {
            background: var(--bg-elevated);
            transform: translateX(4px);
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 4px;
        }
        
        .legend-name {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            flex: 1;
        }
        
        .legend-value {
            font-size: 14px;
            font-weight: 800;
            color: var(--text-primary);
        }
        
        .legend-pct {
            font-size: 11px;
            color: var(--text-muted);
            min-width: 40px;
            text-align: right;
        }
        
        /* Early Detection Impact */
        .impact-grid {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }
        
        .impact-card {
            display: flex;
            align-items: center;
            gap: 18px;
            padding: 20px 22px;
            background: var(--bg-deep);
            border-radius: 14px;
            border: 1px solid var(--border-subtle);
            transition: all 0.3s ease;
        }
        
        .impact-card:hover {
            border-color: var(--border-hover);
            transform: translateX(4px);
        }
        
        .impact-card.highlight {
            background: linear-gradient(135deg, rgba(34,211,238,0.08), rgba(168,85,247,0.05));
            border-color: rgba(34,211,238,0.2);
        }
        
        .impact-icon {
            font-size: 32px;
        }
        
        .impact-content {
            flex: 1;
        }
        
        .impact-value {
            font-size: 32px;
            font-weight: 900;
            color: var(--accent-cyan);
            letter-spacing: -1.5px;
            line-height: 1;
            font-variant-numeric: tabular-nums;
        }
        
        .impact-unit {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-muted);
            margin-left: 2px;
        }
        
        .impact-label {
            font-size: 13px;
            font-weight: 700;
            color: var(--text-primary);
            margin-top: 6px;
        }
        
        .impact-desc {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 2px;
        }
        
        /* Comorbidity Patterns */
        .comorbidity-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 18px;
        }
        
        .comorbidity-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .comorbidity-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-violet), var(--accent-pink));
            opacity: 0.7;
        }
        
        .comorbidity-card:hover {
            border-color: var(--border-hover);
            transform: translateY(-4px);
            box-shadow: 0 16px 40px rgba(0,0,0,0.15);
        }
        
        .comorbidity-card.triple::before {
            background: linear-gradient(90deg, var(--accent-red), var(--accent-amber), var(--accent-pink));
        }
        
        .comorbidity-icons {
            font-size: 28px;
            margin-bottom: 14px;
            display: flex;
            justify-content: center;
            gap: 6px;
        }
        
        .comorbidity-link {
            font-size: 18px;
            color: var(--text-muted);
        }
        
        .comorbidity-names {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 16px;
            line-height: 1.5;
        }
        
        .comorbidity-count {
            font-size: 36px;
            font-weight: 900;
            color: var(--accent-violet);
            letter-spacing: -2px;
            line-height: 1;
            margin-bottom: 6px;
            font-variant-numeric: tabular-nums;
        }
        
        .comorbidity-card.triple .comorbidity-count {
            color: var(--accent-pink);
        }
        
        .comorbidity-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .comorbidity-pct {
            display: inline-block;
            margin-top: 12px;
            padding: 5px 12px;
            background: rgba(168,85,247,0.1);
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            color: var(--accent-violet);
        }
        
        .comorbidity-card.triple .comorbidity-pct {
            background: rgba(236,72,153,0.1);
            color: var(--accent-pink);
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-deep); }
        ::-webkit-scrollbar-thumb { background: var(--bg-elevated); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(148,163,184,0.2); }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .kpi-grid { grid-template-columns: repeat(2, 1fr); }
            .cohort-grid { grid-template-columns: repeat(2, 1fr); }
            .insights-row { grid-template-columns: repeat(3, 1fr); }
            .engine-grid { grid-template-columns: repeat(3, 1fr); }
            .patient-grid { grid-template-columns: repeat(3, 1fr); }
            .analytics-grid { grid-template-columns: 1fr; }
            .comorbidity-grid { grid-template-columns: repeat(2, 1fr); }
            .main { padding: 36px 28px; }
        }
        
        @media (max-width: 768px) {
            .kpi-grid { grid-template-columns: 1fr; }
            .cohort-grid { grid-template-columns: 1fr; }
            .insights-row { grid-template-columns: repeat(2, 1fr); }
            .engine-grid { grid-template-columns: repeat(2, 1fr); }
            .patient-grid { grid-template-columns: 1fr; }
            .analytics-grid { grid-template-columns: 1fr; }
            .comorbidity-grid { grid-template-columns: 1fr; }
            .donut-container { flex-direction: column; }
            .nav { padding: 14px 20px; }
            .page-header { flex-direction: column; align-items: flex-start; gap: 24px; }
            .page-meta { justify-content: flex-start; }
            .meta-item { text-align: left; }
        }
    </style>
</head>
<body>
    <nav class="nav">
        <div class="nav-brand">
            <div class="nav-logo-container"><span class="nav-logo">üß¨</span></div>
            <div class="nav-title-group">
                <div class="nav-title">Burak</div>
                <div class="nav-subtitle">Multiomics Platform</div>
            </div>
        </div>
        <div class="nav-right">
            <div class="status-pill">
                <span class="status-dot"></span>
                <span class="status-text">Live</span>
            </div>
            <a href="burak-home-FINAL.html" class="nav-btn">üè† Home</a>
            <button class="nav-btn" onclick="openClinical()">üî¨ Clinical</button>
        </div>
    </nav>
    
    <div class="main">
        <div class="page-header">
            <div class="page-title-group">
                <div class="page-label">Dashboard</div>
                <h1 class="page-title">Population Health Analytics</h1>
            </div>
            <div class="page-meta">
                <div class="meta-item">
                    <div class="meta-value">41</div>
                    <div class="meta-label">Biomarkers</div>
                </div>
                <div class="meta-item">
                    <div class="meta-value">9</div>
                    <div class="meta-label">Cohorts</div>
                </div>
                <div class="meta-item">
                    <div class="meta-value">7</div>
                    <div class="meta-label">Layers</div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-header">
                <div class="section-title"><span class="section-icon">üìà</span> Key Metrics</div>
            </div>
            <div class="kpi-grid">
                <div class="kpi-card total">
                    <div class="kpi-header">
                        <span class="kpi-label">Total Population</span>
                        <span class="kpi-trend trend-up">‚Üë 12%</span>
                    </div>
                    <div class="kpi-value" id="kpi-total">0</div>
                    <div class="kpi-sub">patients analyzed</div>
                </div>
                
                <div class="kpi-card risk clickable" onclick="openRiskModal('critical')">
                    <div class="kpi-header">
                        <span class="kpi-label">High Risk</span>
                        <span class="kpi-trend trend-down">‚Üì 3%</span>
                    </div>
                    <div class="kpi-value" id="kpi-risk">0</div>
                    <div class="kpi-sub">critical cases</div>
                    <div class="kpi-hint">Click to view ‚Üí</div>
                </div>
                
                <div class="kpi-card intervention clickable" onclick="openRiskModal('warning')">
                    <div class="kpi-header">
                        <span class="kpi-label">Intervention</span>
                        <span class="kpi-trend trend-stable">‚Üí</span>
                    </div>
                    <div class="kpi-value" id="kpi-intervention">0</div>
                    <div class="kpi-sub">warning cases</div>
                    <div class="kpi-hint">Click to view ‚Üí</div>
                </div>
                
                <div class="kpi-card partner">
                    <div class="partner-header">
                        <div class="partner-logo">P1</div>
                        <div>
                            <div class="partner-name">Partner 1</div>
                            <div class="partner-type">Healthcare Provider</div>
                        </div>
                    </div>
                    <select class="batch-select" id="batch-select" onchange="filterBatch()">
                        <option value="all">All Batches (500)</option>
                        <option value="batch-1">Batch #1 ¬∑ Jan 4 ¬∑ 180 pts</option>
                        <option value="batch-2">Batch #2 ¬∑ Jan 2 ¬∑ 145 pts</option>
                        <option value="batch-3">Batch #3 ¬∑ Dec 28 ¬∑ 175 pts</option>
                    </select>
                    <div class="gut-row">
                        <div class="gut-item">
                            <div class="gut-value" id="gut-active">0</div>
                            <div class="gut-label">Gut Active</div>
                        </div>
                        <div class="gut-item">
                            <div class="gut-value" id="gut-dormant">0</div>
                            <div class="gut-label">Dormant</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-header">
                <div class="section-title"><span class="section-icon">‚ö°</span> Quick Insights</div>
            </div>
            <div class="insights-row">
                <div class="insight-card">
                    <div class="insight-icon">üèÜ</div>
                    <div class="insight-value" id="insight-top">T2D</div>
                    <div class="insight-label">Top Cohort</div>
                </div>
                <div class="insight-card">
                    <div class="insight-icon">üìä</div>
                    <div class="insight-value" id="insight-avg">0%</div>
                    <div class="insight-label">Avg Match</div>
                </div>
                <div class="insight-card">
                    <div class="insight-icon">ü¶†</div>
                    <div class="insight-value" id="insight-gut">0%</div>
                    <div class="insight-label">Gut Coverage</div>
                </div>
                <div class="insight-card">
                    <div class="insight-icon">üî¨</div>
                    <div class="insight-value">41</div>
                    <div class="insight-label">Biomarkers</div>
                </div>
                <div class="insight-card">
                    <div class="insight-icon">‚úÖ</div>
                    <div class="insight-value">100%</div>
                    <div class="insight-label">Processed</div>
                </div>
            </div>
        </div>
        
        <!-- Analytics Section -->
        <div class="section">
            <div class="section-header">
                <div class="section-title"><span class="section-icon">üìä</span> Analytics</div>
                <div class="section-badge">Live</div>
            </div>
            <div class="analytics-grid">
                <!-- Cohort Distribution Donut -->
                <div class="analytics-card distribution">
                    <div class="analytics-header">
                        <div class="analytics-title">
                            <span class="analytics-title-icon">ü•ß</span>
                            Cohort Distribution
                        </div>
                    </div>
                    <div class="donut-container">
                        <div class="donut-chart">
                            <svg width="180" height="180" viewBox="0 0 180 180">
                                <circle cx="90" cy="90" r="70" fill="none" stroke="#1e293b" stroke-width="24"/>
                                <circle id="donut-t2d" cx="90" cy="90" r="70" fill="none" stroke="#f59e0b" stroke-width="24" stroke-dasharray="0 440" stroke-linecap="round"/>
                                <circle id="donut-cardio" cx="90" cy="90" r="70" fill="none" stroke="#f43f5e" stroke-width="24" stroke-dasharray="0 440" stroke-linecap="round"/>
                                <circle id="donut-nafld" cx="90" cy="90" r="70" fill="none" stroke="#8b5cf6" stroke-width="24" stroke-dasharray="0 440" stroke-linecap="round"/>
                                <circle id="donut-other" cx="90" cy="90" r="70" fill="none" stroke="#64748b" stroke-width="24" stroke-dasharray="0 440" stroke-linecap="round"/>
                            </svg>
                            <div class="donut-center">
                                <div class="donut-center-value" id="donut-total">0</div>
                                <div class="donut-center-label">Patients</div>
                            </div>
                        </div>
                        <div class="donut-legend" id="donut-legend">
                            <!-- Generated by JS -->
                        </div>
                    </div>
                </div>
                
                <!-- Early Detection Impact -->
                <div class="analytics-card alerts">
                    <div class="analytics-header">
                        <div class="analytics-title">
                            <span class="analytics-title-icon">üíé</span>
                            Early Detection Impact
                        </div>
                    </div>
                    <div class="impact-grid">
                        <div class="impact-card">
                            <div class="impact-icon">üéØ</div>
                            <div class="impact-content">
                                <div class="impact-value" id="impact-early">0</div>
                                <div class="impact-label">Patients Flagged</div>
                                <div class="impact-desc">Before clinical symptoms</div>
                            </div>
                        </div>
                        <div class="impact-card">
                            <div class="impact-icon">ü¶†</div>
                            <div class="impact-content">
                                <div class="impact-value" id="impact-gut">0</div>
                                <div class="impact-label">Gut-Linked Discoveries</div>
                                <div class="impact-desc">Unique to multi-omics</div>
                            </div>
                        </div>
                        <div class="impact-card highlight">
                            <div class="impact-icon">‚ö°</div>
                            <div class="impact-content">
                                <div class="impact-value">6.2<span class="impact-unit">mo</span></div>
                                <div class="impact-label">Avg Early Detection</div>
                                <div class="impact-desc">Ahead of standard screening</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Comorbidity Section -->
        <div class="section">
            <div class="section-header">
                <div class="section-title"><span class="section-icon">üîó</span> Comorbidity Patterns</div>
                <div class="section-badge">Multi-Morbidity</div>
            </div>
            <div class="comorbidity-grid" id="comorbidity-grid">
                <!-- Generated by JS -->
            </div>
        </div>
        
        <div class="section">
            <div class="section-header">
                <div class="section-title"><span class="section-icon">üéØ</span> Disease Cohorts</div>
                <div class="section-badge">9 Active</div>
            </div>
            <div class="cohort-grid" id="cohort-grid"></div>
        </div>
        
        <div class="section">
            <div class="section-header">
                <div class="section-title"><span class="section-icon">‚öôÔ∏è</span> Processing Engine</div>
                <div class="section-badge">Active</div>
            </div>
            <div class="engine-grid">
                <div class="engine-card">
                    <div class="engine-value">27</div>
                    <div class="engine-label">Blood Markers</div>
                    <div class="engine-bar"><div class="engine-fill" style="width:100%"></div></div>
                </div>
                <div class="engine-card">
                    <div class="engine-value">5</div>
                    <div class="engine-label">Inflammation</div>
                    <div class="engine-bar"><div class="engine-fill" style="width:100%"></div></div>
                </div>
                <div class="engine-card">
                    <div class="engine-value">3</div>
                    <div class="engine-label">Sentinels</div>
                    <div class="engine-bar"><div class="engine-fill" style="width:100%"></div></div>
                </div>
                <div class="engine-card">
                    <div class="engine-value">9</div>
                    <div class="engine-label">Cohorts</div>
                    <div class="engine-bar"><div class="engine-fill" style="width:100%"></div></div>
                </div>
                <div class="engine-card">
                    <div class="engine-value" id="engine-gut">0</div>
                    <div class="engine-label">Gut Links</div>
                    <div class="engine-bar"><div class="engine-fill" style="width:30%"></div></div>
                </div>
                <div class="engine-card">
                    <div class="engine-value">7</div>
                    <div class="engine-label">Layers</div>
                    <div class="engine-bar"><div class="engine-fill" style="width:100%"></div></div>
                </div>
            </div>
        </div>
        
        <footer class="footer">
            <p class="footer-text">Developed by <span class="footer-name">Waseem Ahmad Ahanger</span></p>
        </footer>
    </div>
    
    <div class="modal-overlay" id="modal" onclick="closeModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">
                    <span id="modal-icon">üë•</span>
                    <span id="modal-title-text">Patients</span>
                    <span class="modal-count" id="modal-count">(0)</span>
                </div>
                <button class="modal-close" onclick="closeModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="patient-grid" id="patient-grid"></div>
            </div>
        </div>
    </div>
    
    <script>
        const cohorts = [
            { id: 't2d', name: 'T2D Syndrome', icon: 'üç¨' },
            { id: 'cardio', name: 'Cardiovascular', icon: '‚ù§Ô∏è' },
            { id: 'nafld', name: 'NAFLD Risk', icon: 'ü´Å' },
            { id: 'renal', name: 'Renal Decay', icon: 'üíß' },
            { id: 'inflammation', name: 'Chronic Inflammation', icon: 'üî•' },
            { id: 'obesity', name: 'Metabolic Obesity', icon: '‚öñÔ∏è' },
            { id: 'nutrient', name: 'Nutrient Depletion', icon: 'üß¨' },
            { id: 'ibd', name: 'IBD Pattern', icon: 'üî¥' },
            { id: 'thyroid', name: 'Thyroid Stress', icon: '‚ö°' }
        ];
        
        let patients = [];
        let currentBatch = 'all';
        
        function init() {
            for (let i = 1; i <= 500; i++) {
                const numCohorts = Math.floor(Math.random() * 3) + 1;
                const shuffled = [...cohorts].sort(() => 0.5 - Math.random());
                const assigned = shuffled.slice(0, numCohorts).map((c, idx) => ({
                    ...c,
                    match: idx === 0 ? Math.floor(Math.random() * 40) + 55 : Math.floor(Math.random() * 35) + 30
                }));
                
                const primaryMatch = assigned[0].match;
                let risk = 'stable';
                if (primaryMatch >= 70) risk = 'critical';
                else if (primaryMatch >= 50) risk = 'warning';
                
                let batch = 'batch-1';
                if (i > 180 && i <= 325) batch = 'batch-2';
                else if (i > 325) batch = 'batch-3';
                
                patients.push({ id: `BM${1000 + i}`, cohorts: assigned, risk, hasGut: Math.random() > 0.7, batch });
            }
            render();
        }
        
        function render() {
            const filtered = currentBatch === 'all' ? patients : patients.filter(p => p.batch === currentBatch);
            
            const critical = filtered.filter(p => p.risk === 'critical').length;
            const warning = filtered.filter(p => p.risk === 'warning').length;
            const gutActive = filtered.filter(p => p.hasGut).length;
            
            animateNum('kpi-total', filtered.length);
            animateNum('kpi-risk', critical);
            animateNum('kpi-intervention', warning);
            animateNum('gut-active', gutActive);
            animateNum('gut-dormant', filtered.length - gutActive);
            animateNum('engine-gut', gutActive);
            
            // Update Early Detection Impact
            const earlyDetected = Math.round(filtered.length * 0.18); // ~18% flagged early
            animateNum('impact-early', earlyDetected);
            animateNum('impact-gut', gutActive);
            
            document.getElementById('insight-avg').textContent = Math.round(filtered.reduce((a, p) => a + p.cohorts[0].match, 0) / filtered.length) + '%';
            document.getElementById('insight-gut').textContent = Math.round((gutActive / filtered.length) * 100) + '%';
            
            const stats = cohorts.map(c => {
                const pts = filtered.filter(p => p.cohorts[0].id === c.id);
                const avg = pts.length ? Math.round(pts.reduce((a, p) => a + p.cohorts[0].match, 0) / pts.length) : 0;
                return {
                    ...c,
                    count: pts.length,
                    pct: ((pts.length / filtered.length) * 100).toFixed(1),
                    avg,
                    critical: pts.filter(p => p.risk === 'critical').length,
                    warning: pts.filter(p => p.risk === 'warning').length,
                    stable: pts.filter(p => p.risk === 'stable').length,
                    gut: pts.filter(p => p.hasGut).length
                };
            }).sort((a, b) => b.count - a.count);
            
            // Update Donut Chart
            updateDonutChart(stats, filtered.length);
            
            // Update Comorbidity Patterns
            updateComorbidity(filtered);
            
            document.getElementById('cohort-grid').innerHTML = stats.map(c => `
                <div class="cohort-card" onclick="openCohortModal('${c.id}')">
                    <div class="cohort-header">
                        <span class="cohort-icon">${c.icon}</span>
                        <span class="cohort-gut">${c.gut} ü¶†</span>
                    </div>
                    <div class="cohort-name">${c.name}</div>
                    <div class="cohort-stats">
                        <span class="cohort-count">${c.count}</span>
                        <span class="cohort-pct">${c.pct}%</span>
                    </div>
                    <div class="match-row">
                        <div class="match-header"><span>Avg Match</span><span>${c.avg}%</span></div>
                        <div class="match-bar"><div class="match-fill ${c.avg >= 70 ? 'match-high' : c.avg >= 50 ? 'match-medium' : 'match-low'}" style="width:${c.avg}%"></div></div>
                    </div>
                    <div class="risk-row">
                        <div class="risk-item critical"><div class="risk-value">${c.critical}</div><div class="risk-label">Critical</div></div>
                        <div class="risk-item warning"><div class="risk-value">${c.warning}</div><div class="risk-label">Warning</div></div>
                        <div class="risk-item stable"><div class="risk-value">${c.stable}</div><div class="risk-label">Stable</div></div>
                    </div>
                </div>
            `).join('');
        }
        
        function updateDonutChart(stats, total) {
            const topCohorts = stats.slice(0, 4);
            const colors = ['#f59e0b', '#f43f5e', '#8b5cf6', '#64748b'];
            const circumference = 2 * Math.PI * 70; // 440
            
            document.getElementById('donut-total').textContent = total;
            
            let offset = 0;
            topCohorts.forEach((c, i) => {
                const pct = c.count / total;
                const dash = pct * circumference;
                const circle = document.getElementById(['donut-t2d', 'donut-cardio', 'donut-nafld', 'donut-other'][i]);
                if (circle) {
                    circle.style.stroke = colors[i];
                    circle.setAttribute('stroke-dasharray', `${dash} ${circumference}`);
                    circle.setAttribute('stroke-dashoffset', -offset);
                    offset += dash;
                }
            });
            
            // Update Legend
            document.getElementById('donut-legend').innerHTML = topCohorts.map((c, i) => `
                <div class="legend-item" onclick="openCohortModal('${c.id}')">
                    <div class="legend-color" style="background: ${colors[i]}"></div>
                    <div class="legend-name">${c.icon} ${c.name}</div>
                    <div class="legend-value">${c.count}</div>
                    <div class="legend-pct">${c.pct}%</div>
                </div>
            `).join('');
        }
        
        function updateComorbidity(filtered) {
            // Calculate patients with multiple cohorts
            const multiMorbid = filtered.filter(p => p.cohorts.length >= 2);
            
            // Define comorbidity patterns
            const patterns = [
                { 
                    ids: ['t2d', 'cardio'], 
                    icons: ['üç¨', '‚ù§Ô∏è'], 
                    names: 'T2D + Cardiovascular',
                    triple: false
                },
                { 
                    ids: ['t2d', 'nafld'], 
                    icons: ['üç¨', 'ü´Å'], 
                    names: 'T2D + NAFLD',
                    triple: false
                },
                { 
                    ids: ['cardio', 'renal'], 
                    icons: ['‚ù§Ô∏è', 'üíß'], 
                    names: 'Cardio + Renal',
                    triple: false
                },
                { 
                    ids: ['t2d', 'cardio', 'nafld'], 
                    icons: ['üç¨', '‚ù§Ô∏è', 'ü´Å'], 
                    names: 'T2D + Cardio + NAFLD',
                    triple: true
                }
            ];
            
            const comorbidityData = patterns.map(p => {
                const count = multiMorbid.filter(patient => {
                    const patientCohortIds = patient.cohorts.map(c => c.id);
                    return p.ids.every(id => patientCohortIds.includes(id));
                }).length;
                
                return {
                    ...p,
                    count,
                    pct: ((count / filtered.length) * 100).toFixed(1)
                };
            });
            
            document.getElementById('comorbidity-grid').innerHTML = comorbidityData.map(c => `
                <div class="comorbidity-card ${c.triple ? 'triple' : ''}">
                    <div class="comorbidity-icons">
                        ${c.icons.map((icon, i) => `<span>${icon}</span>${i < c.icons.length - 1 ? '<span class="comorbidity-link">+</span>' : ''}`).join('')}
                    </div>
                    <div class="comorbidity-names">${c.names}</div>
                    <div class="comorbidity-count">${c.count}</div>
                    <div class="comorbidity-label">Patients</div>
                    <div class="comorbidity-pct">${c.pct}% of cohort</div>
                </div>
            `).join('');
        }
        
        function animateNum(id, target) {
            const el = document.getElementById(id);
            let curr = 0;
            const step = Math.ceil(target / 25);
            const int = setInterval(() => {
                curr += step;
                if (curr >= target) { curr = target; clearInterval(int); }
                el.textContent = curr;
            }, 25);
        }
        
        function filterBatch() {
            currentBatch = document.getElementById('batch-select').value;
            render();
        }
        
        function openRiskModal(type) {
            const filtered = currentBatch === 'all' ? patients : patients.filter(p => p.batch === currentBatch);
            let pts;
            if (type === 'critical') {
                pts = filtered.filter(p => p.risk === 'critical');
                document.getElementById('modal-icon').textContent = 'üö®';
                document.getElementById('modal-title-text').textContent = 'High Risk Patients';
            } else {
                pts = filtered.filter(p => p.risk === 'warning');
                document.getElementById('modal-icon').textContent = '‚ö†Ô∏è';
                document.getElementById('modal-title-text').textContent = 'Warning Cases';
            }
            document.getElementById('modal-count').textContent = `(${pts.length})`;
            renderPatients(pts.sort((a, b) => b.cohorts[0].match - a.cohorts[0].match));
            document.getElementById('modal').classList.add('active');
        }
        
        function openCohortModal(id) {
            const filtered = currentBatch === 'all' ? patients : patients.filter(p => p.batch === currentBatch);
            const cohort = cohorts.find(c => c.id === id);
            const pts = filtered.filter(p => p.cohorts[0].id === id);
            document.getElementById('modal-icon').textContent = cohort.icon;
            document.getElementById('modal-title-text').textContent = cohort.name;
            document.getElementById('modal-count').textContent = `(${pts.length})`;
            renderPatients(pts.sort((a, b) => b.cohorts[0].match - a.cohorts[0].match));
            document.getElementById('modal').classList.add('active');
        }
        
        function renderPatients(pts) {
            document.getElementById('patient-grid').innerHTML = pts.map(p => `
                <div class="patient-card" onclick="openClinical()">
                    <div class="patient-header">
                        <span class="patient-id">${p.id}</span>
                        <span class="patient-gut ${p.hasGut ? '' : 'dormant'}">ü¶†</span>
                    </div>
                    <div class="patient-match">
                        <div class="patient-pct ${p.risk === 'critical' ? 'high' : p.risk === 'warning' ? 'medium' : 'low'}">${p.cohorts[0].match}%</div>
                        <span class="patient-risk ${p.risk}">${p.risk}</span>
                    </div>
                    <div class="patient-cohort">
                        <span class="patient-cohort-icon">${p.cohorts[0].icon}</span>
                        <span class="patient-cohort-name">${p.cohorts[0].name}</span>
                    </div>
                    ${p.cohorts.length > 1 ? `
                        <div class="patient-secondary">
                            <div class="secondary-label">Secondary</div>
                            <div class="secondary-tags">${p.cohorts.slice(1).map(c => `<div class="sec-tag">${c.icon} <span class="sec-tag-pct">${c.match}%</span></div>`).join('')}</div>
                        </div>
                    ` : ''}
                    <div class="patient-footer"><span class="clinical-link">View Clinical ‚Üí</span></div>
                </div>
            `).join('');
        }
        
        function closeModal(e) {
            if (!e || e.target.id === 'modal') document.getElementById('modal').classList.remove('active');
        }
        
        function openClinical() { alert('üî¨ Clinical Layer\n\n(Developer will connect)'); }
        
        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });
        init();
    </script>
</body>
</html>
